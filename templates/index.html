{% extends "layout.html" %}
{% block faviconType %}favicon.ico{% endblock %}
{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
{% endblock %}

{% block container %}
<h3>Formulario de solicitud</h3>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js">   
</script>   

<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.js">   
</script>   

<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/themes/ui-lightness/jquery-ui.css"
    rel="stylesheet" type="text/css" />   
    <input type="text" id="tags"> 
<div class="borderTable align-middle">
    <!-- TODO: Añadir los campos del formulario de google -->
    <form id="searchForm" action="#" method="post">
      <input type="text" class="form-control" id="searchByName" name="searchByName" placeholder="Título">
      <ul id="suggestions" style="display: none;"></ul>
      <input type="text" class="form-control" id="searchByISBN" name="searchByISBN" placeholder="ISBN">
      <input type="button" class="form-control" name="search" value="Añadir">
    </form>

    <form id="reqForm" action="/solicitar" method="post">
    <table id="licencias" class="table table-striped table-hover" style="width:100%">
      <thead>
        <tr>
          <th>Título</th>
          <th>ISBN</th>
        </tr>
      </thead>
      <tbody>
        <!-- TODO: Aquí hay que añadir los filtros entre el título y el ISBN -->
        <!--<th><input type="number" class="form-control" name="numlic_1" required></th>-->
      </tbody>
      <tfoot>
        <tr>
          <td></td>
          <td>
            {% if role == "interno" or role == "promotor" %}
            <th><button type="button" id="showModal" class="btn btn-primary">Enviar</button></th>
            {% else %}
            <th><button type="submit" name="action" value="solicitar">Solicitar</th>
            {% endif %}
          </td>
          <td></td>
        </tr>
      </tfoot>
    </table>
    <div class="modal fade" id="sendModal" tabindex="-1" aria-labelledby="sendModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">Enviar mensaje</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cancelar"></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="recipient-name" class="col-form-label">Destinatario:</label>
                <input type="text" name="email" class="form-control" id="recipient-name">
              </div>
              <div class="mb-3">
                <label for="message-text" class="col-form-label">Mensaje:</label>
                <textarea class="form-control" name="message" id="message-text"></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            <button type="submit" name="action" value="solicitar" class="btn btn-primary">Enviar</button>
          </div>
        </div>
      </div>
    </div>
  </form>
</div>

{% endblock %}

{% block user_info %}
  {{ super() }}
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    var showModal = document.getElementById("showModal")

    showModal.onclick = function () {
      var form = document.getElementById("reqForm")
      if (! form.checkValidity()){
        alert("Se han de rellenar todos los campos")
      }else{
        var myModal = new bootstrap.Modal(document.getElementById('sendModal'), {
        keyboard: false
        });
        myModal.show();
      }
    }
  </script>
  <script>var books = {{ books_data|tojson }}</script>
  <script> 
    $( function() { 
      var ISBNs = []
      for (var book in books) {
        console.log(book)
        ISBNs.push(books[book].isbn)
      }
      console.log(ISBNs)
      $( "#tags" ).autocomplete({ 
        source: ISBNs 
      }); 
    } ); 
  </script> 
  <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
  <script src="{{ url_for('static', filename='js/bookFunctions.js')}}"></script>
{% endblock %}